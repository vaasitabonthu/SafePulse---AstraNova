<!DOCTYPE html>
<html>
<head>
<title>SafePulse - Construction Access</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Font Awesome -->
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0D273D, #3E6985);
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.container {
    display: flex;
    width: 950px;
    height: 520px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 25px 60px rgba(0,0,0,0.4);
}

.left-panel {
    flex: 1;
    background: linear-gradient(160deg, #0D273D, #3E6985);
    color: white;
    padding: 60px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.left-panel h1 {
    font-size: 48px;
    margin-bottom: 20px;
}

.left-panel p {
    font-size: 18px;
    opacity: 0.85;
}

.right-panel {
    flex: 1;
    background: #CDD7DF;
    display: flex;
    justify-content: center;
    overflow-y: auto;
    align-items: center;
}

.card {
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(10px);
    padding: 35px;
    width: 360px;
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
}

.card h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #0D273D;
}

input, select {
    width: 100%;
    padding: 12px;
    margin-bottom: 14px;
    border-radius: 10px;
    border: none;
    background: #A6BED1;
    outline: none;
    box-sizing: border-box;
}

button {
    width: 100%;
    padding: 12px;
    background: #3E6985;
    border: none;
    color: white;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
}

button:hover {
    background: #0D273D;
}

.toggle {
    text-align: center;
    margin-top: 15px;
    cursor: pointer;
    color: #0D273D;
    font-size: 14px;
}

.error {
    font-size: 13px;
    color: red;
    min-height: 18px;
    text-align: center;
}

.hidden {
    display: none;
}

.password-container {
    position: relative;
    width: 100%;
}

.password-container input {
    padding-right: 40px;
}

.toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #0D273D;
}
</style>
</head>

<body>

<div class="container">

<div class="left-panel">
    <h1>SafePulse</h1>
    <p>Protecting Workers.<br>Empowering Supervisors.</p>
</div>

<div class="right-panel">
<div class="card">

<h2 id="formTitle">Login</h2>

<!-- LOGIN NAME -->
<input type="text" id="loginName" placeholder="Full Name">

<!-- SIGNUP NAME -->
<input type="text" id="signupName" placeholder="Full Name" class="hidden">

<select id="gender" class="hidden">
    <option value="">Select Gender</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
</select>

<input type="email" id="email" placeholder="Email" class="hidden">

<div class="password-container">
  <input type="password" id="password" placeholder="Password">
  <i class="fas fa-eye toggle-password" onclick="togglePassword('password', this)"></i>
</div>

<div class="password-container hidden" id="confirmPasswordContainer">
  <input type="password" id="confirmPassword" placeholder="Confirm Password">
  <i class="fas fa-eye toggle-password" onclick="togglePassword('confirmPassword', this)"></i>
</div>

<select id="role" class="hidden">
    <option value="worker">Worker</option>
    <option value="supervisor">Supervisor</option>
</select>

<select id="area" class="hidden">
    <option value="Site A">Construction Site A</option>
    <option value="Site B">Construction Site B</option>
    <option value="Site C">Construction Site C</option>
    <option value="Site D">Construction Site D</option>
    <option value="Site E">Construction Site E</option>
</select>

<input type="text" id="supervisorCode" placeholder="Supervisor Access Code" class="hidden">

<div class="error" id="errorMsg"></div>

<button onclick="handleAuth()" id="actionBtn">Login</button>

<div class="toggle" onclick="toggleForm()">
    Don't have an account? Sign Up
</div>

</div>
</div>
</div>

<script>

const AREA_CODES = {
    "Site A": "SITEA26",
    "Site B": "SITEB26",
    "Site C": "SITEC26",
    "Site D": "SITED26",
    "Site E": "SITEE26"
};

let isLogin = true;

function toggleForm() {
    isLogin = !isLogin;

    document.getElementById("loginName").classList.toggle("hidden");
    document.getElementById("signupName").classList.toggle("hidden");
    document.getElementById("gender").classList.toggle("hidden");
    document.getElementById("email").classList.toggle("hidden");
    document.getElementById("confirmPasswordContainer").classList.toggle("hidden");
    document.getElementById("role").classList.toggle("hidden");
    document.getElementById("area").classList.toggle("hidden");

    document.getElementById("supervisorCode").classList.add("hidden");

    const title = document.getElementById("formTitle");
    const btn = document.getElementById("actionBtn");
    const toggleText = document.querySelector(".toggle");
    const errorMsg = document.getElementById("errorMsg");

    errorMsg.innerText = "";

    if (isLogin) {
        title.innerText = "Login";
        btn.innerText = "Login";
        toggleText.innerText = "Don't have an account? Sign Up";
    } else {
        title.innerText = "Sign Up";
        btn.innerText = "Create Account";
        toggleText.innerText = "Already have an account? Login";
    }
}

document.getElementById("role").addEventListener("change", function() {
    if (!isLogin && this.value === "supervisor") {
        document.getElementById("supervisorCode").classList.remove("hidden");
    }
});

function handleAuth() {

    const password = document.getElementById("password").value;
    const errorMsg = document.getElementById("errorMsg");
    let users = JSON.parse(localStorage.getItem("users")) || [];

    errorMsg.innerText = "";

    if (isLogin) {

        const loginName = document.getElementById("loginName").value.trim();

        const user = users.find(u =>
            u.name === loginName &&
            u.password === password
        );

        if (!user) {
            errorMsg.innerText = "Invalid Name or Password.";
            return;
        }

        localStorage.setItem("currentUser", JSON.stringify(user));

        if (user.role === "worker") {
            window.location.href = "worker-dashboard.html";
        } else {
            window.location.href = "supervisor-dashboard.html";
        }

    } else {

        const name = document.getElementById("signupName").value.trim();
        const gender = document.getElementById("gender").value;
        const email = document.getElementById("email").value.trim();
        const confirmPassword = document.getElementById("confirmPassword").value;
        const role = document.getElementById("role").value;
        const area = document.getElementById("area").value;
        const supervisorCode = document.getElementById("supervisorCode").value;

        if (!name || !gender || !email) {
            errorMsg.innerText = "All fields are required.";
            return;
        }

        if (password !== confirmPassword) {
            errorMsg.innerText = "Passwords do not match.";
            return;
        }

        if (role === "supervisor" && supervisorCode !== AREA_CODES[area]) {
            errorMsg.innerText = "Invalid Supervisor Code.";
            return;
        }

        if (users.find(u => u.name === name)) {
            errorMsg.innerText = "User already exists.";
            return;
        }

        users.push({ name, gender, email, password, role, area });
        localStorage.setItem("users", JSON.stringify(users));

        errorMsg.style.color = "green";
        errorMsg.innerText = "Account created successfully! Please login.";
        toggleForm();
    }
}

function togglePassword(fieldId, icon) {
    const input = document.getElementById(fieldId);

    if (input.type === "password") {
        input.type = "text";
        icon.classList.replace("fa-eye", "fa-eye-slash");
    } else {
        input.type = "password";
        icon.classList.replace("fa-eye-slash", "fa-eye");
    }
}
</script>

</body>
</html>